https://github.com/DimsKotov/weblarek#

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Vite

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/main.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

# Интернет-магазин «Web-Larёk»

«Web-Larёk» — это интернет-магазин с товарами для веб-разработчиков, где пользователи могут просматривать товары, добавлять их в корзину и оформлять заказы. Сайт предоставляет удобный интерфейс с модальными окнами для просмотра деталей товаров, управления корзиной и выбора способа оплаты, обеспечивая полный цикл покупки с отправкой заказов на сервер.

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP (Model-View-Presenter), которая обеспечивает четкое разделение ответственности между классами слоев Model и View. Каждый слой несет свой смысл и ответственность:

Model - слой данных, отвечает за хранение и изменение данных.  
View - слой представления, отвечает за отображение данных на странице.  
Presenter - презентер содержит основную логику приложения и отвечает за связь представления и данных.

Взаимодействие между классами обеспечивается использованием событийно-ориентированного подхода. Модели и Представления генерируют события при изменении данных или взаимодействии пользователя с приложением, а Презентер обрабатывает эти события используя методы как Моделей, так и Представлений.

### Базовый код

#### Класс Component

Является базовым классом для всех компонентов интерфейса.
Класс является дженериком и принимает в переменной `T` тип данных, которые могут быть переданы в метод `render` для отображения.

Конструктор:  
`constructor(container: HTMLElement)` - принимает ссылку на DOM элемент за отображение, которого он отвечает.

Поля класса:  
`container: HTMLElement` - поле для хранения корневого DOM элемента компонента.

Методы класса:  
`render(data?: Partial<T>): HTMLElement` - Главный метод класса. Он принимает данные, которые необходимо отобразить в интерфейсе, записывает эти данные в поля класса и возвращает ссылку на DOM-элемент. Предполагается, что в классах, которые будут наследоваться от `Component` будут реализованы сеттеры для полей с данными, которые будут вызываться в момент вызова `render` и записывать данные в необходимые DOM элементы.  
`setImage(element: HTMLImageElement, src: string, alt?: string): void` - утилитарный метод для модификации DOM-элементов `<img>`

#### Класс Api

Содержит в себе базовую логику отправки запросов.

Конструктор:  
`constructor(baseUrl: string, options: RequestInit = {})` - В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Поля класса:  
`baseUrl: string` - базовый адрес сервера  
`options: RequestInit` - объект с заголовками, которые будут использованы для запросов.

Методы:  
`get(uri: string): Promise<object>` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер  
`post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object>` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.  
`handleResponse(response: Response): Promise<object>` - защищенный метод проверяющий ответ сервера на корректность и возвращающий объект с данными полученный от сервера или отклоненный промис, в случае некорректных данных.

#### Класс EventEmitter

Брокер событий реализует паттерн "Наблюдатель", позволяющий отправлять события и подписываться на события, происходящие в системе. Класс используется для связи слоя данных и представления.

Конструктор класса не принимает параметров.

Поля класса:  
`_events: Map<string | RegExp, Set<Function>>)` - хранит коллекцию подписок на события. Ключи коллекции - названия событий или регулярное выражение, значения - коллекция функций обработчиков, которые будут вызваны при срабатывании события.

Методы класса:  
`on<T extends object>(event: EventName, callback: (data: T) => void): void` - подписка на событие, принимает название события и функцию обработчик.  
`emit<T extends object>(event: string, data?: T): void` - инициализация события. При вызове события в метод передается название события и объект с данными, который будет использован как аргумент для вызова обработчика.  
`trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие с передачей в него данных из второго параметра.

### Модели данных

#### Класс Catalog

Хранит список всех доступных товаров и управляет состоянием выбранного товара для просмотра.

Конструктор класса не принимает параметров.

Поля класса:
`products: IProduct[]` — Массив объектов хранящих доступные товары.
`selectedProduct: IProduct | undefined` — Товар выбранный для подробного отображения.

Методы класса:
`saveProducts(products: IProduct[])` - Сохраняет массив продуктов, полученных в качестве аргумента.
`getProducts(): IProduct[]` - Возвращает массив всех доступных товаров.
`getProductById(id: string)` - Получает продукт по уникальному id и возвращает объект типа IProduct.
`selectProduct(product: IProduct)` - Cохранение товара для подробного отображения.
`getSelectedProduct(): IProduct | undefined` - Получение товара для подробного отображения.

#### Класс Cart

Отвечает за управление списком товаров, выбранных пользователем для оформления заказа.

Конструктор класса не принимает параметров.

Поля класса:
`items: IProduct[]` — Массив объектов типа IProduct находящиеся в корзине.

Методы класса:
`addItem(item: IProduct)` - Добавляет новый товар в корзину.
`removeItem(item: IProduct)` - Удаляет выбранный товар из корзины.
`clearCart()` - Очищает содержимое корзины.
`getItems(): IProduct[]` - Возвращает массив товаров в корзине.
`getTotalPrice(): number` - Получает общую стоимость товаров в корзине.
`getCount(): number` - Возвращает количество товаров в корзине.
`hasItem(id: string): boolean` - Проверяет наличие товара в корзине по его идентификатору.

#### Класс Buyer

Обеспечивает хранение и проверку персональных данных покупателя.

Конструктор класса не принимает параметров.

Поля класса:
`payment: TPayment` — Способ оплаты.
`email: string` — Электронная почта покупателя.
`phone: string` — Номер телефона покупателя.
`address: string` — Адрес доставки.

Методы класса:
`saveAddress(address: string)` - Сохранение адреса покупателя.
`savePhone(phone: string)` - Сохранение телефона покупателя.
`saveEmail(phone: string)` - Сохранение телефона покупателя.
`savePayment(phone: TPayment)` - Сохранение телефона покупателя.
`getData(payment: TPayment, email: string, phone: string, address: string)` - Возвращает полный объект с персональными данными покупателя.
`clearData()` - Очищает данные покупателя.
`validate(): ValidationResult` - Проверяет правильность введенных данных и возвращает объект с результатами проверки. Поля объекта содержащие ошибку, содержат строку с описанием проблемы.

### Слой коммуникации

#### Класс Api

Отправляет запросы на сервер для получения списка товаров (GET) и отправки заказа (POST).

Конструктор класса: 
`constructor(api: IApi)` - Принимает объект интерфейса IApi, который обеспечивает доступ к необходимым методам для выполнения сетевых операций.

Поля класса:
`api: IApi` — Базовый адрес сервера API.

Методы класса:
`fetchProducts(): Promise<ProductListResponse>` - Возвращает список всех доступных продуктов с сервера. Результат представляет собой массив объектов.
`sendOrder(order: OrderRequest): Promise<object>` - Формирует заказ клиента и отправляет его на сервер методом POST.

### Компоненты представления (View)

#### Класс Header

Компонент заголовка отображает количество элементов в корзине и обрабатывает событие открытия корзины при клике на соответствующую кнопку.

Конструктор класса:
`constructor(events: IEvents, container: HTMLElement)` - events: Объект типа IEvents, обеспечивающий управление событиями приложения. container: Элемент DOM, внутри которого компонент будет инициализирован.

Поля класса:
`protected counterElement: HTMLElement` - Элемент страницы, содержащий счётчик количества товаров в корзине.
`protected basketButton: HTMLButtonElement` - Кнопка открытия корзины.

Методы класса:

`set counter(value: number)` - Устанавливает значение счётчика товаров в корзине.

#### Класс Gallary

Класс представляет собой компонент галереи изображений, предназначенный для отображения элементов каталога внутри контейнера HTML-элементов.

Конструктор класса:
`constructor(container: HTMLElement)` - Родительский HTML-контейнер, внутри которого находится элемент с классом .gallery.

Поля класса:
`catalogElement: HTMLElement` - Каталог товаров.

Методы класса:

`catalog(items: HTMLElement[])` - сеттер для отображения счётчика товаров в корзине.

#### Класс Modal

Класс Modal представляет собой компонент для управления отображением модального окна. Модал используется для показа дополнительного содержимого поверх основного интерфейса страницы.

Конструктор класса:

`constructor(container: HTMLElement, events: IEvents)` - Инициализирует экземпляр компонента модального окна, принимает контейнер элемента и объект событий (IEvents), обрабатывающий внутренние события компонента.

Поля класса:
`protected modalElement: HTMLElement` - элемент DOM, содержащий основное содержимое модального окна.
`protected closeButton: HTMLButtonElement` - rнопка предназначенная для закрытия модального окна.
`protected pageWrapper: HTMLElement` - контейнер страницы, используемый для изменения состояния скролла.
`modalStatus: boolean` - флаг, отражающий состояние открытия модального окна (true - открыто, false - закрыто).

Методы класса:

`set content(items: HTMLElement)` - позволяет заменить содержимое модального окна новым элементом.
`openModal(): void` - открывает модальное окно и инициирует событие "modal:open".
`closeModal(): void` - закрывает модальное окно и инициирует событие "modal:close".

#### Класс Basket

Класс Basket реализует функциональность корзины покупок, позволяя управлять списком товаров, общей суммой покупки и состоянием кнопки оформления заказа.

Конструктор класса:

`constructor(events: IEvents, container: HTMLElement)` - Инициализирует экземпляр компонента корзины, принимая объект событий (events) и контейнер (container), внутри которого размещается интерфейс корзины.

Поля класса:

`protected totalPriceCounter: HTMLElemen` - Элемент DOM, предназначенный для отображения итоговой суммы товаров в корзине. 
`protected basketButton: HTMLButtonElement` - Кнопка, связанная с оформлением заказа или действиями с корзиной.
`protected basketList: HTMLElement` - Контейнер элементов DOM, содержащий список товаров в корзине.

Методы класса:

`set listOfProducts(value: HTMLElement[])` - Устанавливает новый список продуктов в корзину, заменяя предыдущий контент контейнера списка товаров.
`set totalCounter(value: string)` - Обновляет значение итоговой стоимости товаров в корзине.
`set buttonStatus(value: boolean)` - Изменяет доступность кнопки оформления заказа, делая её активной или неактивной.
`public isEmpty(): boolean` - Возвращает булевое значение, проверяя наличие товаров в корзине.

#### Класс Form

Класс Form реализует базовую функциональность форм ввода, обеспечивая управление процессом отправки формы, обработку ошибок и изменение состояний полей.

Конструктор класса:

`constructor(container: HTMLElement, events: IEvents)` - Инициализирует экземпляр компонента формы, передавая ей контейнер элемента формы и объект событий (events), ответственный за внутреннее взаимодействие компонентов.

Поля класса:

`protected submitBtn: HTMLButtonElement` - Кнопка отправки формы (HTMLButtonElement, type=submit).
`protected errorContainer: HTMLElement` - Контейнер DOM-элементов, предназначенный для вывода сообщений об ошибках.

Методы класса:

`inputChange(field: keyof IBuyer, value: string | null)` - Этот метод вызывается при изменении значений полей формы и генерирует событие "form:change" с информацией о каком именно поле изменилось и какое новое значение оно приняло.
`set valid(isValid: boolean)` - Устанавливает статус валидности формы и меняет состояние кнопки отправки формы (disabled=true, если форма неверно заполнена).
`set errors(message: string | null)` - Заполняет контейнер ошибок сообщениями об ошибках или очищает его при отсутствии ошибок.

#### Класс Order

Класс Order расширяет функциональностью абстрактного класса Form, реализуя модальное окно обработки заказов, включая ввод адреса доставки и выбор способа оплаты.

Конструктор класса:

`constructor(container: HTMLFormElement, events: IEvents)` - Инициализирует экземпляр компонента формы заказа, принимающего контейнер формы и объект событий (events), управляющий внутренними процессами компонента.

Поля класса:

`protected addressInput: HTMLInputElement` -  Поле ввода адреса доставки типа HTMLInputElement.
`protected paymentButtons: HTMLButtonElement[]` - Массив кнопок выбора способов оплаты (HTMLButtonElement[]).

Методы класса:

`inputChange(field: keyof IOrder, value: string | null)` - Генерируется автоматически родительским классом при любом изменении полей формы. Данный метод передает новые значения выбранных полей («адрес» или способ оплаты) обратно через механизм событий.
`set payment(payment: TPayment | null)` - Метод устанавливает активный способ оплаты, выделяя соответствующую кнопку выбором CSS-класса.
`set address(value: string)` - Устаналивает введенный адрес доставки в поле ввода.

#### Класс Contact

Класс Contact наследует функциональность базового класса Form, обеспечивая работу формы контактов с полями для ввода электронной почты и номера телефона.

Конструктор класса:

`constructor(container: HTMLFormElement, events: IEvents)` - Инициализирует экземпляр компонента формы контакта, принимая контейнер формы и объект событий (events), координирующий взаимодействие компонентов.

Поля класса:

`protected emailInput: HTMLInputElement` - Поле ввода электронной почты типа HTMLInputElement.
`protected phoneInput: HTMLInputElement` - Поле ввода телефонного номера типа HTMLInputElement.

Методы класса:

`inputChange(field: keyof IContact, value: string | null)` - Генерируется автоматически родительским классом при каждом изменении значений полей формы. Эти изменения транслируются через внутренний механизм событий.
`set email(value: string)` - Метод устанавливает заданное значение электронной почты в соответствующем поле ввода.
`set phone(value: string)` - Метод устанавливает заданное значение телефонного номера в соответствующем поле ввода.

#### Класс Success

Класс Success представляет собой компонент уведомления успешного завершения оформление заказа, выводящего пользователю сообщение подтверждения вместе итоговой стоимость заказа с возможностью закрыть уведомление или перейти далее к покупкам.

Конструктор класса:

`constructor(container: HTMLFormElement, events: IEvents)` - Инициализирует экземпляр компонента формы контакта, принимая контейнер формы и объект событий (events), координирующий взаимодействие компонентов.

Поля класса:

`protected modalCounter: HTMLElement` - Элемент DOM, текст c общей стоимостью всего заказа.
`protected modalButton: HTMLButtonElement` - Кнопка перехода к покупкам снова, закрывает модальное окно при нажатии.

Методы класса:

`set total(value: string)` - Меняет общую стоимость всего заказа.

#### Класс Card

Абстрактный класс Card представляет базовую реализацию карточек товара, содержащих название, изображение, описание и цену. Карточки предназначены для представления кратких сведений о продукте веб-интерфейсе.

Конструктор класса:

`constructor(container: HTMLElement)` - Инициализирует экземпляр карточки, привязывая её к переданному контейнеру (container).

Поля класса:

`protected cardTitle: HTMLElement` - Элемент DOM, хранящий название карточки продукта.
`protected cardPrice: HTMLElement` - Элемент DOM, отображающий стоимость продукта.

Методы класса:

`set title(value: string)` - Метод изменяет текст названия карточки на указанный в параметре.
`set price(value: number | null)` - Устанавливает цену продукта, преобразовывая числовое значение в текст. Если цена равна null, то выводится строка «Бесценно».

#### Класс CardBasket

Класс CardBasket расширяет функциональность абстрактного класса Card, представляя карточку товара непосредственно в корзине покупок. Компонент позволяет выводить информацию о товаре и добавлять возможность удалить товар из корзины.

Конструктор класса:

`constructor(container: HTMLElement, events: EventEmitter)` - 

Поля класса:

`protected indexProduct: HTMLElement` - Элемент DOM, отображающий порядковый индекс товара в списке корзины.
`protected deleteProduct: HTMLButtonElement` - Кнопка для удаления товара из корзины (HTMLButtonElement).
`protected productId: string = ''` - Уникальный идентификатор товара.

Методы класса:

`set index(value: number)` - Устанавливает порядковый номер товара в корзине, записывая его в элемент индекса.
`set id(value: string)` - Присваивает уникальный идентификатор товару, который впоследствии используется для идентификации товара при удалении.

#### Класс CardCatalog

Класс CardCatalog расширяет функциональность абстрактного класса Card, создавая карточку товара каталога. Она предназначена для отображения информации о товаре в каталоге продукции сайта, включая категорию, изображение и подробное описание с ценой.

Конструктор класса:

`constructor(container: HTMLElement, actions?: ICardActions)` - Инициализирует экземпляр карточки товара в каталоге, принимает контейнер элемента и необязательные действия (ICardActions), позволяющие добавить реакцию на клик по карточке.

Поля класса:

`protected cardImage: HTMLImageElement` -  Изображение товара.
`protected cardCatagory: HTMLElement` - Элемент DOM, отображающий категорию товара.

Методы класса:

`set image(src: string)` - Загружает изображение товара, используя CDN и добавляя альтернативный текст, совпадающий с названием товара.
`set category(value: string)` - Устанавливает категорию товара и применяет соответствующие классы стиля на основании карты категорий (categoryMap).

#### Класс CardPreview

Класс CardPreview расширяет функционал абстрактного класса Card, формируя предварительный просмотр карточки товара. Предназначен для демонстрации основных характеристик товара: изображения, категории, краткого описания и кнопки купить.

Конструктор класса:

`constructor(container: HTMLElement, events: IEvents)` - Инициализирует экземпляр предварительного просмотра карточки товара, привязывая его к указанному контейнеру и передавая объект событий (events), использующийся для обработки внутренних событий компонента.

Поля класса:

`protected cardImage: HTMLImageElement` - Изображение товара.
`protected cardCategory: HTMLElement` - Категория товара.
`protected cardDescription: HTMLElement` - Описание товара.
`protected cardButton: HTMLButtonElement` - Кнопка действия.

Методы класса:

`set image(value: string)` - Устанавливает путь к изображению товара, предварительно дополнив его ссылкой на CDN.
`set category(value: string)` - Устанавливает категорию товара, присваивая текст соответствующего элемента.
`set description(value: string)` - Задавая текст элемента, формирует краткое описание товара.
`set buttonText(value: string)` - Изменяет надпись на кнопке и управляет её доступностью, отключая кнопку, если текст равен "Недоступно".

### События

`data:change` - событие запускается при изменении данных формы. Это событие используется для обновления интерфейса, проверки валидности данных и рендеринга новых состояний формы.
`catalog:change` - событие запускается при изменении структуры или состава каталога товаров. Оно отвечает за обновление галереи товаров, динамическое создание карточек товаров и организацию их вывода на странице.
`card:select` - событие возникает при выборе пользователем определенной карточки товара в каталоге. 
`catalog:select` - событие запускается при выборе определенного товара в каталоге. Основная цель события — зафиксировать выбранный товар.
`card:button` - событие запускается при нажатии кнопки в карточке товара.
`cart:change` - событие запускается при изменении состояния корзины (добавлении или удалении товаров).
`product:delete` - событие запускается при удаления товара из корзины.
`basket:arrange` событие запускается при нажатии пользователя на кнопку оформить заказ из корзины.
`form:change` - событие запускается каждый раз, когда изменяется значение какого-либо поля формы. 
`data:change` - событие запускается при внесении изменений в данные формы (при редактировании полей формы или введении новой информации).
`order:submit` - событие запускается при нажатии кнопки в первой форме, открывает второе окно формы покупателя.
`contacts:submit` - событие запускается при нажатии кнопки "Оплатить".
`modal:close` - - событие запускается при нажатии кнопки "К новым покупкам".

### Презентер

Реализован паттерн MVP. Этот архитектурный шаблон позволяет разделить приложение на три основных компонента:

Модель — хранит бизнес-данные и логику приложения.
Вид  — отображает интерфейс и взаимодействует с пользователем.
Презентер — связующее звено между моделью и видом, обрабатывающее события интерфейса и обновляющее вид на основании изменений модели.

`data:change` - Обработчик гарантирует, что интерфейс формы всегда соответствует актуальным данным и отражает правильность ввода данных пользователем, своевременно реагируя на любые изменения полей формы.
`catalog:change` - Главная задача обработчика — поддерживать актуальность отображаемых товаров в каталоге, быстро создавать и вставлять карточки товаров в интерфейс, а также обеспечивать навигацию по ним посредством выделения конкретной карточки при выборе товара.
`card:select` - обеспечить согласованность поведения приложения и интерфейса при взаимодействии пользователя с карточками товаров. Пользователь сможет видеть выбранную карточку и дополнительные детали выбранного товара.
`catalog:select` - Предоставить пользователю подробное представление о выбранном товаре, включающее важные характеристики и кнопки для принятия решений (купить, удалить из корзины или показать недоступность товара).
`card:button` - Реализовать простую и эффективную логику работы с корзиной товаров: пользователь может добавлять товары в корзину.
`cart:change` - Обеспечить синхронизацию состояния корзины с интерфейсом, отображая точное количество товаров, суммарную стоимость и актуальные карточки товаров в корзине.
`product:delete` - Обеспечиваем удаление товара из корзины с последующей корректировкой интерфейса: кнопка оформления заказа деактивируется, если корзина опустела, и наоборот — активизируется при наличии товаров.
`basket:arrange` - Открывает первое модальное окно для оформления заказа.
`form:change` - Обработчик события обеспечивает постоянное синхронное обновление модели покупателя при любом изменении полей формы.
`data:change` - Обновить состояние формы и контактных данных в зависимости от внесённых изменений и результатов валидации.
`order:submit` - Обработчик события способствует переходу от формы заказа к форме контактных данных.
`contacts:submit` - Завершить процедуру оформления заказа, сохранив покупку на сервере и очистив локальные данные, предоставив пользователю подтверждение успешного заказа.
`modal:close` - закрывает модальное окно.